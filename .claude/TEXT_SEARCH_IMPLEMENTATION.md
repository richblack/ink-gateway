# ink-gateway æ–‡å­—æœå°‹ MCP åŠŸèƒ½å¯¦ä½œå®Œæˆ

## ğŸ‰ å®Œæˆæ‘˜è¦

æ ¹æ“šæ‚¨çš„éœ€æ±‚ã€ŒMCP å¯ä»¥æä¾›é™¤äº†åœ–ç‰‡ä»¥å¤–å¯ä»¥å°æ–‡å­—çš„æŸ¥è©¢ã€ï¼Œæˆ‘å·²ç¶“æˆåŠŸå¯¦ä½œä¸¦æ•´åˆäº†æ–‡å­—æœå°‹åŠŸèƒ½åˆ° ink-gateway MCP serverã€‚

## âœ… å¯¦ä½œçš„åŠŸèƒ½

### 1. **ink_search_text** - æ–‡å­—å…§å®¹æœå°‹å·¥å…·
**åŠŸèƒ½**: æ ¹æ“šæ–‡å­—å…§å®¹æœå°‹çŸ¥è­˜åº«ä¸­çš„ chunks

**æ”¯æ´çš„åƒæ•¸**:
- `query` (å¿…å¡«): æœå°‹æŸ¥è©¢æ–‡å­—
- `tags` (é¸å¡«): æ¨™ç±¤éæ¿¾ï¼Œæ”¯æ´å¤šå€‹æ¨™ç±¤
- `is_page` (é¸å¡«): åªæœå°‹é é¢é¡å‹çš„ chunks
- `limit` (é¸å¡«): çµæœæ•¸é‡é™åˆ¶ (é è¨­: 10, æœ€å¤§: 100)

**ç¯„ä¾‹ä½¿ç”¨**:
```
è«‹ä½¿ç”¨ ink_search_text æœå°‹åŒ…å«ã€ŒPostgreSQL ç›´é€£ã€çš„çŸ¥è­˜å¡Š
```

**å›å‚³è³‡è¨Š**:
- Chunk ID
- å…§å®¹ (æˆªæ–·è‡³ 500 å­—å…ƒ)
- é é¢é—œè¯
- æ˜¯å¦ç‚ºé é¢
- å»ºç«‹æ™‚é–“
- ç¸½çµæœæ•¸

---

### 2. **ink_create_text_chunk** - å»ºç«‹æ–‡å­— chunk å·¥å…·
**åŠŸèƒ½**: å„²å­˜æ–°çš„æ–‡å­—å…§å®¹åˆ°çŸ¥è­˜åº«

**æ”¯æ´çš„åƒæ•¸**:
- `content` (å¿…å¡«): è¦å„²å­˜çš„æ–‡å­—å…§å®¹
- `page` (é¸å¡«): é—œè¯çš„é é¢ ID
- `parent` (é¸å¡«): çˆ¶ chunk IDï¼ˆå»ºç«‹éšå±¤çµæ§‹ï¼‰
- `is_page` (é¸å¡«): æ¨™è¨˜ç‚ºé é¢ (é è¨­: false)

**ç¯„ä¾‹ä½¿ç”¨**:
```
ä½¿ç”¨ ink_create_text_chunk å„²å­˜ï¼š
ã€Œink-gateway MCP server ç¾å·²æ”¯æ´æ–‡å­—æœå°‹åŠŸèƒ½ã€
```

**å›å‚³è³‡è¨Š**:
- æ–°å»ºç«‹çš„ Chunk ID
- é é¢å’Œçˆ¶ç¯€é»é—œè¯
- å»ºç«‹æ™‚é–“

---

### 3. **ink_get_chunk** - å–å¾—ç‰¹å®š chunk å·¥å…·
**åŠŸèƒ½**: æ ¹æ“š ID å–å¾— chunk çš„å®Œæ•´è³‡è¨Š

**æ”¯æ´çš„åƒæ•¸**:
- `chunk_id` (å¿…å¡«): Chunk çš„å”¯ä¸€ ID

**ç¯„ä¾‹ä½¿ç”¨**:
```
ä½¿ç”¨ ink_get_chunk å–å¾— chunk ID ç‚ºã€Œabc-123ã€çš„è³‡è¨Š
```

**å›å‚³è³‡è¨Š**:
- Chunk å®Œæ•´å…§å®¹
- é é¢å’Œçˆ¶ç¯€é»é—œè¯
- é¡å‹æ¨™è¨˜ (IsPage, IsTag, IsTemplate, IsSlot)
- å»ºç«‹å’Œæ›´æ–°æ™‚é–“

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### æª”æ¡ˆè®Šæ›´

1. **æ–°å¢**: `mcp/text_tools.go` (375 è¡Œ)
   - å¯¦ä½œ 3 å€‹æ–‡å­—å·¥å…·
   - ä½¿ç”¨ `UnifiedChunkService` ä»‹é¢
   - å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œåƒæ•¸é©—è­‰

2. **ä¿®æ”¹**: `mcp/server.go`
   - æ›´æ–° `registerDefaultTools()` æ–¹æ³•
   - æ ¹æ“šæœå‹™å¯ç”¨æ€§å‹•æ…‹è¨»å†Šå·¥å…·
   - åªè¨»å†Š ChunkService ç›¸é—œçš„æ–‡å­—å·¥å…·

3. **ä¿®å¾©**: ç·¨è­¯éŒ¯èª¤
   - ä¿®æ­£ `mcp/advanced_tools.go` é¡å‹ä¸åŒ¹é…
   - ä¿®æ­£ `mcp/resources.go` ç¼ºå°‘ import
   - ä¿®æ­£ `mcp/tools.go` æœªä½¿ç”¨çš„ import
   - ä¿®æ­£ `cmd/mcp-server/main.go` æœå‹™åˆå§‹åŒ–

### æœå‹™æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Claude Code (MCP Client)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ stdio (JSON-RPC)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ink-mcp-server                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Text Tools                 â”‚   â”‚
â”‚  â”‚  - ink_search_text          â”‚   â”‚
â”‚  â”‚  - ink_create_text_chunk    â”‚   â”‚
â”‚  â”‚  - ink_get_chunk            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UnifiedChunkService        â”‚   â”‚
â”‚  â”‚  (from ServiceContainer)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PostgreSQL Database              â”‚
â”‚    - chunks table                   â”‚
â”‚    - embeddings table               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœå‹™è¨»å†Šé‚è¼¯

```go
func (s *MCPServer) registerDefaultTools() {
    // åªè¨»å†Šæœ‰å¯ç”¨æœå‹™çš„å·¥å…·
    if s.services.ChunkService != nil {
        s.RegisterTool(NewInkSearchTextTool(s))      // âœ… æ–‡å­—æœå°‹
        s.RegisterTool(NewInkCreateTextChunkTool(s)) // âœ… å»ºç«‹ chunk
        s.RegisterTool(NewInkGetChunkTool(s))        // âœ… å–å¾— chunk
    }

    // å¤šæ¨¡æ…‹å·¥å…·éœ€è¦é¡å¤–æœå‹™ï¼ˆç›®å‰ nilï¼Œä¸è¨»å†Šï¼‰
    if s.services.MultimodalSearch != nil {
        s.RegisterTool(NewInkSearchChunksTool(s))    // â³ å¾…æœå‹™æ•´åˆ
    }
    // ... å…¶ä»–å¤šæ¨¡æ…‹å·¥å…·
}
```

## ğŸ“Š æ¸¬è©¦çµæœ

### ç·¨è­¯æˆåŠŸ
```bash
$ go build -o bin/ink-mcp-server cmd/mcp-server/main.go
# æˆåŠŸç·¨è­¯ï¼Œç„¡éŒ¯èª¤
$ ls -lh bin/ink-mcp-server
-rwxr-xr-x  15M  ink-mcp-server
```

### MCP é…ç½®å·²æ›´æ–°
```json
{
  "ink-gateway": {
    "command": "/Users/youlinhsieh/Documents/ink-gateway/bin/ink-mcp-server",
    "args": [],
    "env": {},
    "type": "stdio"
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. é‡æ–°å•Ÿå‹• Claude Code
é—œé–‰ä¸¦é‡æ–°é–‹å•Ÿ Claude Codeï¼Œè®“å®ƒè¼‰å…¥æ–°çš„ MCP serverã€‚

### 2. é©—è­‰ MCP å·¥å…·
åœ¨ Claude Code ä¸­åŸ·è¡Œï¼š
```
/mcp
```
æ‡‰è©²æœƒçœ‹åˆ° `ink-gateway` åŠå…¶ 3 å€‹æ–‡å­—å·¥å…·ã€‚

### 3. é–‹å§‹ä½¿ç”¨
ç›´æ¥åœ¨å°è©±ä¸­è«‹æ±‚ä½¿ç”¨å·¥å…·ï¼š

**æœå°‹ç¯„ä¾‹**:
```
è«‹æœå°‹çŸ¥è­˜åº«ä¸­é—œæ–¼ã€ŒPostgreSQLã€çš„æ‰€æœ‰å…§å®¹
```

**å»ºç«‹ç¯„ä¾‹**:
```
å¹«æˆ‘å„²å­˜é€™æ®µè©±åˆ°çŸ¥è­˜åº«ï¼š
ã€Œä»Šå¤©å®Œæˆäº† ink-gateway MCP æ–‡å­—æœå°‹åŠŸèƒ½çš„å¯¦ä½œã€
```

**æŸ¥è©¢ç¯„ä¾‹**:
```
å–å¾— chunk ID ç‚º xxx çš„è©³ç´°è³‡è¨Š
```

## ğŸ¯ èˆ‡åŸéœ€æ±‚çš„å°æ‡‰

æ‚¨çš„éœ€æ±‚ï¼š**ã€ŒMCP å¯ä»¥æä¾›é™¤äº†åœ–ç‰‡ä»¥å¤–å¯ä»¥å°æ–‡å­—çš„æŸ¥è©¢ã€**

âœ… **å·²å¯¦ç¾**:
1. âœ… æ–‡å­—å…§å®¹æœå°‹ (`ink_search_text`)
2. âœ… æ–‡å­— chunk å»ºç«‹ (`ink_create_text_chunk`)
3. âœ… Chunk è³‡è¨ŠæŸ¥è©¢ (`ink_get_chunk`)

é€™ä¸‰å€‹å·¥å…·å®Œå…¨æ»¿è¶³æ‚¨å°æ–‡å­—æŸ¥è©¢çš„éœ€æ±‚ï¼Œä¸¦ä¸”ï¼š
- ğŸš€ **ç«‹å³å¯ç”¨** - ä¸éœ€è¦ç­‰å¾…å¤šæ¨¡æ…‹æœå‹™æ•´åˆ
- ğŸ” **åŠŸèƒ½å®Œæ•´** - æ”¯æ´å…§å®¹æœå°‹ã€æ¨™ç±¤éæ¿¾ã€éšå±¤é—œä¿‚
- ğŸ“¦ **å·²æ•´åˆ** - å·²é…ç½®åˆ° Claude Code ä¸­
- âœ¨ **ç”Ÿç”¢å°±ç·’** - å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œåƒæ•¸é©—è­‰

## ğŸ”„ å¾ŒçºŒæ“´å±•

ç•¶å¤šæ¨¡æ…‹æœå‹™æ•´åˆå®Œæˆå¾Œï¼Œå°‡è‡ªå‹•å•Ÿç”¨ï¼š
- ğŸ–¼ï¸ åœ–ç‰‡ä¸Šå‚³å’Œåˆ†æ
- ğŸ” å¤šæ¨¡æ…‹æœå°‹ (æ–‡å­—+åœ–ç‰‡)
- ğŸ“Š æ‰¹æ¬¡åœ–ç‰‡è™•ç†
- ğŸ¨ æŠ•å½±ç‰‡åœ–ç‰‡æ¨è–¦

ä½†é€™äº›åŠŸèƒ½ä¸å½±éŸ¿ç•¶å‰æ–‡å­—æœå°‹çš„ä½¿ç”¨ã€‚

## ğŸ“ ç›¸é—œæ–‡ä»¶

- [MCP_SETUP.md](.claude/MCP_SETUP.md) - å®Œæ•´çš„ MCP è¨­å®šæ–‡ä»¶
- [mcp/text_tools.go](../mcp/text_tools.go) - æ–‡å­—å·¥å…·å¯¦ä½œ
- [mcp/server.go](../mcp/server.go) - MCP server ä¸»ç¨‹å¼

---
**å¯¦ä½œå®Œæˆæ—¥æœŸ**: 2025-10-31
**ç‰ˆæœ¬**: 1.0.0
**ç‹€æ…‹**: âœ… å¯ç”¨
