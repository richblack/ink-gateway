# Ink-Gateway 使用者需求

> **給 Kiro 的說明**: 這份文件描述使用者的實際需求與問題，請你根據這些需求進行 User Story Mapping 和 Spec Driven Development。技術實作細節由你規劃。

---

## 🎯 我想要什麼？

### 核心想法

我想要一個**通用的知識管理系統**，能夠：

1. **在任何地方寫筆記**
   - 主要在 Obsidian 寫
   - 但也想在 VSCode 寫
   - 甚至在 Claude Desktop 直接問答時也能寫入

2. **圖片和文字一樣好搜尋**
   - 我有很多架構圖、流程圖、截圖
   - 現在只能靠檔名找圖片，很難找
   - 我希望能用「系統架構」這種關鍵字就找到相關圖片

3. **圖片統一管理在雲端**
   - 所有圖片自動上傳到統一的雲端位置（Google Drive 或 Google Photos）
   - 不管圖片原本在哪個資料夾（Obsidian、Logseq、專案資料夾...）
   - 系統自動備份並記錄雲端 ID
   - 未來存取都從雲端讀取，不用擔心本地路徑變動
   - 可以彈性切換雲端儲存服務（Google Drive → NAS → Dropbox）

4. **做簡報時能自動找到相關圖片**
   - 我用 Slide Generator 做簡報
   - 我希望它能從我的筆記庫裡找圖片
   - 也能找到相關的文字內容
   - 這樣我就不用每次都重新找圖

---

## 👥 使用者角色

### 角色 1: 筆記書寫者 (我自己)
**我想要**:
- 在 Obsidian 輕鬆寫筆記
- 拖放圖片就能加到筆記裡
- 系統自動幫我整理和索引

**我的痛點**:
- 圖片太多，找不到
- 不知道哪些筆記有相關的圖
- 圖片散落在各個專案資料夾，難以統一管理
- 換電腦時路徑會變，很麻煩

### 角色 2: 簡報製作者 (我自己)
**我想要**:
- 在筆記裡寫「我要做一份架構簡報」
- Claude Code 自動從我的筆記找資料
- 生成包含我筆記圖片的簡報

**我的痛點**:
- 每次做簡報都要重新找圖
- 不記得哪些圖適合這個主題
- 手動整理很花時間

### 角色 3: 開發者 (我自己)
**我想要**:
- 在 VSCode 寫程式時能查筆記
- 問 Claude「我之前怎麼解決這個問題？」
- 它能從我的筆記庫找答案

**我的痛點**:
- 要切換到 Obsidian 才能查筆記
- 打斷工作流程

---

## 📖 使用情境故事

### 情境 1: 日常寫筆記

**角色**: 筆記書寫者

**情境描述**:
> 我在學習微服務架構，看了一些文章，也畫了一些架構圖。

**使用流程**:
1. 我打開 Obsidian，建立一個「微服務學習筆記」
2. 我寫下我的理解和心得
3. 我從 Figma 匯出一張架構圖 `microservices-architecture.png`
4. 我把圖片拖進 Obsidian
5. **系統自動**:
   - 上傳圖片到雲端（Google Drive）
   - 取得雲端 ID 和 URL
   - 分析圖片內容（「這是一個包含 API Gateway、Service Discovery 的微服務架構圖」）
   - 計算檔案 hash（用於去重和識別）
   - 建立索引和向量
   - 記錄本地路徑 + 雲端位置

**期望結果**:
- 圖片安全儲存在雲端
- 本地也保留一份（原始資料夾）
- 我之後搜尋「API Gateway」能找到這張圖
- 我之後搜尋「微服務」也能找到這篇筆記和圖片
- 在任何裝置都能存取這張圖（透過雲端 ID）

---

### 情境 2: 批次整理舊圖片

**角色**: 筆記書寫者

**情境描述**:
> 我有一個資料夾，裡面有 100 張過去累積的技術圖片，我想全部整理進系統。

**使用流程**:
1. 我在 Obsidian Plugin 設定中「新增監控資料夾」
2. 選擇資料夾 `/Users/you/Downloads/tech-images/`
3. 勾選「自動上傳到雲端」
4. 系統開始處理:
   - 掃描資料夾
   - 顯示「找到 100 張圖片」
   - 我可以選擇要處理哪些
5. 我點「開始處理」
6. 系統顯示進度:
   - 上傳中... 25/100
   - 分析中... 25/100
   - 索引中... 25/100
7. 完成後告訴我「已上傳並索引 100 張圖片」

**期望結果**:
- 所有圖片都上傳到雲端
- 每張圖片都有 AI 描述和向量索引
- 記錄了本地路徑和雲端 ID
- 我能用關鍵字找到這些圖片
- 不用手動一張一張處理

---

### 情境 3: 製作技術簡報

**角色**: 簡報製作者

**情境描述**:
> 我要做一份「微服務架構導論」的簡報，我想用我筆記裡的資料。

**使用流程**:
1. 我在 Obsidian 寫一篇「簡報需求」:
   ```markdown
   # 微服務架構導論簡報

   需要包含:
   - 什麼是微服務
   - 核心組件介紹（API Gateway, Service Discovery）
   - 架構圖範例
   - 優缺點分析
   ```

2. 我打開 Claude Code
3. 我說：「根據我的筆記，用 Slide Generator 做一份微服務簡報」
4. **系統自動**:
   - 從我的筆記找相關文字內容
   - 從我的圖片庫找相關架構圖
   - 配對文字與圖片
5. Slide Generator 生成 `microservices-intro.pptx`

**期望結果**:
- 簡報內容來自我的筆記
- 圖片是我之前畫的架構圖
- 我不用手動複製貼上

---

### 情境 4: 開發時查詢筆記

**角色**: 開發者

**情境描述**:
> 我在 VSCode 寫 Go 程式，遇到一個之前解決過的問題。

**使用流程**:
1. 我在 VSCode 開啟 Claude
2. 我問：「我之前怎麼處理 Go 的 context timeout？」
3. Claude 透過 MCP 查詢我的筆記庫
4. 找到我之前的筆記和範例程式碼
5. 顯示給我看

**期望結果**:
- 不用離開 VSCode
- 快速找到答案
- 工作流程不被打斷

---

### 情境 5: 搜尋圖片

**角色**: 筆記書寫者

**情境描述**:
> 我想找「資料庫架構」相關的圖片，但我不記得檔名。

**使用流程**:
1. 我在 Obsidian 打開搜尋
2. 輸入「資料庫架構」
3. 系統顯示:
   - 包含這個關鍵字的文字筆記
   - **AI 分析後認為相關的圖片**（即使圖片裡沒有這個文字）
4. 我看到一張 PostgreSQL 的 ER 圖
5. 點擊後跳到包含這張圖的筆記

**期望結果**:
- 用語義搜尋，不只是檔名
- 圖片和文字一起顯示
- 能快速找到想要的圖

---

## 🎯 核心需求整理

### 需求 1: 圖片管理
**我想要**:
- 拖放圖片到 Obsidian 就自動處理
- 批次匯入資料夾裡的圖片
- 看到圖片的 AI 描述
- 編輯圖片的標籤

**不需要**:
- 圖片編輯功能（用其他工具處理）
- 圖片壓縮（保持原檔）

### 需求 2: 圖片搜尋
**我想要**:
- 用關鍵字找圖片（語義搜尋）
- 看到相似度分數
- 點擊圖片跳到原筆記
- 也能「以圖找圖」

**不需要**:
- 複雜的篩選條件
- 相簿式的瀏覽介面

### 需求 3: 圖片統一上傳與雲端管理
**我想要**:
- 第一期就自動上傳到 Google Drive（統一位置）
- 所有圖片都有雲端 ID，不依賴本地路徑
- 未來能切換雲端服務（Google Drive → Google Photos → NAS → Dropbox）
- 切換時只要改設定，資料庫中的雲端 ID 不變
- 跨裝置使用時，直接從雲端讀取，不需要同步本地路徑

**實作重點**:
- 索引圖片時同步上傳到雲端
- 記錄：
  - 本地路徑（供參考，方便本地編輯）
  - 雲端 ID（唯一識別，主要存取方式）
  - 檔案 hash（用於去重和識別同一張圖）
- 設計可插拔的 Storage Adapter：
  - GoogleDriveAdapter
  - GooglePhotosAdapter
  - NASAdapter
  - DropboxAdapter
- 每個 Adapter 實作：
  - Upload(file) → (id, url)
  - Download(id) → file
  - Delete(id)

### 需求 4: MCP 整合
**我想要**:
- VSCode 能查詢我的筆記
- Claude Desktop 能查詢我的筆記
- 未來任何支援 MCP 的工具都能用

**我需要的操作**:
- 搜尋筆記（文字和圖片）
- 建立筆記
- 分析圖片
- 批次處理圖片
- 推薦圖片（給 Slide Generator）

### 需求 5: Slide Generator 整合
**我想要**:
- Slide Generator 能從我的筆記找資料
- 包括文字內容
- 包括相關圖片
- 自動配對圖文

**使用方式**:
- 我在筆記寫簡報需求
- Claude Code 呼叫 Slide Generator
- 自動生成 PPTX

---

## ❌ 我不需要什麼

### 不需要的功能
- ❌ 圖片編輯（裁切、濾鏡等）
- ❌ 圖片分享功能
- ❌ 多人協作編輯
- ❌ 版本控制（Git 已經處理）
- ❌ 複雜的權限管理

### 不需要的介面
- ❌ 獨立的網頁介面
- ❌ 手機 App
- ❌ 桌面應用程式

### 保持簡單
- ✅ Obsidian Plugin 是主要介面
- ✅ 其他工具透過 MCP 存取
- ✅ 專注在「好用」而不是「功能多」

---

## 🔧 技術限制與偏好

### 必須遵守
1. **只能透過 Supabase API 存取資料庫**
   - 不可以直接連線資料庫
   - 這是 Ink-Gateway 的核心約束

2. **使用現有的 UnifiedChunk 資料結構**
   - 不要建立新的資料表
   - 用 metadata 欄位存圖片資訊

### 技術偏好
1. **雲端儲存**: 第一期用 Google Drive
   - 我有 Google 帳號
   - API 穩定、免費額度充足
   - 未來可以切換到 Google Photos 或 NAS

2. **圖片描述**: 用 GPT-4 Vision 或 Claude 3
   - 我有 API key
   - 描述要詳細、準確

3. **圖片 Embedding**: 用 CLIP
   - 開源、免費
   - 品質好

4. **文字 Embedding**: 用 OpenAI text-embedding-3-small
   - 已經在用
   - 成本低

5. **檔案識別**: 用 SHA256 hash
   - 不依賴檔名
   - 用於去重和識別同一張圖片

---

## 📊 優先順序

### P0 - 第一階段必做（核心功能）
1. ✅ **資料夾監控機制**（監控多個資料夾）
2. ✅ **Google Drive 上傳**（自動上傳到統一位置）
3. ✅ **檔案 Hash 計算**（SHA256，用於識別）
4. ✅ **AI 圖片描述生成**（GPT-4 Vision）
5. ✅ **圖片向量索引**（CLIP embedding）
6. ✅ **圖片語義搜尋**（從雲端讀取）
7. ✅ **雙向路徑記錄**（本地路徑 + 雲端 ID）
8. ✅ **Obsidian Plugin 整合**（拖放上傳）
9. ✅ **批次處理功能**（掃描資料夾批次上傳）

### P1 - 第二階段（整合與優化）
10. ✅ MCP Server 基礎功能
11. ✅ Slide Generator 整合
12. ✅ VSCode 整合測試
13. ✅ 混合搜尋（文字+圖片）
14. ✅ 搜尋結果優化
15. ✅ 快取機制（雲端圖片本地快取）

### P2 - 第三階段（進階功能）
16. ✅ 以圖搜圖
17. ✅ 圖片去重（hash 比對）
18. ✅ 效能優化（批次上傳、並行處理）
19. ✅ 離線模式（本地快取優先）

### P3 - 未來擴展
20. ⏸️ 切換到 Google Photos
21. ⏸️ NAS 支援
22. ⏸️ Dropbox 支援
23. ⏸️ 圖片 OCR（文字識別）
24. ⏸️ 影片處理支援

---

## 💡 成功標準

### 第一階段完成時
**我能做到**:
- 在 Obsidian 拖放圖片就自動處理
- 搜尋關鍵字能找到相關圖片
- 看到圖片的 AI 描述
- 圖片儲存在本地資料夾

**驗證方式**:
- 上傳 10 張技術圖片
- 用「微服務」搜尋，能找到相關圖片
- 描述準確度 > 80%

### 第二階段完成時
**我能做到**:
- 批次匯入 100 張舊圖片
- 用 Slide Generator 生成包含我筆記圖片的簡報
- 在 VSCode 查詢我的筆記

**驗證方式**:
- 批次處理 100 張圖片 < 10 分鐘
- 生成的簡報包含正確的圖片
- VSCode 能正確顯示搜尋結果

### 第三階段完成時
**我能做到**:
- 搜尋結果又快又準
- 圖文混合搜尋效果好
- 日常使用流暢

**驗證方式**:
- 搜尋回應時間 < 1 秒
- 相關度排序準確
- 沒有明顯 bug

---

## 🤔 需要 Kiro 幫我規劃的

### 技術設計
- 怎麼設計圖片儲存的抽象層？
- 怎麼讓未來能輕鬆切換儲存方式？
- MCP Tools 要定義哪些？
- API 端點怎麼設計？

### 開發計畫
- 分成幾個 Sprint？
- 每個 Sprint 做什麼？
- 哪些可以平行開發？
- 測試策略是什麼？

### 資料設計
- UnifiedChunk 的 metadata 要放什麼？
- Embeddings 表要怎麼擴展？
- 搜尋索引怎麼設計？

---

## 📝 補充說明

### 關於圖片儲存
我說「不要寫死」的意思是：

**不好的設計** ❌:
```go
// 寫死在程式碼裡
func UploadImage(file) {
    // 只能存本地
    os.WriteFile("/Users/you/images/"+filename, data)
}
```

**好的設計** ✅:
```go
// 可以插拔不同實作
type StorageAdapter interface {
    Upload(file) (id, url, error)
}

// 本地實作
type LocalStorage struct { ... }

// 未來的 Google Drive 實作
type GoogleDriveStorage struct { ... }

// 使用時
storage := config.GetStorageAdapter()  // 可以切換
storage.Upload(file)
```

### 關於掃描與管理
不同儲存方式的「掃描」意思不同：

- **本地資料夾**: 掃描檔案系統，找到所有圖片
- **Google Drive**: 呼叫 API，列出資料夾內容
- **Google Photos**: 呼叫 API，取得相簿列表
- **NAS**: 透過 SMB/NFS 協議掃描

每種都要能：
1. 列出圖片
2. 上傳新圖片
3. 取得圖片 URL
4. （可選）刪除圖片

### 關於 Slide Generator
它已經是一個 MCP 工具了，我希望：

1. Slide Generator 可以呼叫 Ink-Gateway 的 MCP Tools
2. 取得相關的文字和圖片
3. 用這些資料生成簡報

工作流程：
```
使用者 → Claude Code → Slide Generator (MCP)
                            ↓
                        呼叫 Ink-Gateway (MCP)
                            ↓
                        取得圖文資料
                            ↓
                        生成 PPTX
```

---

## 🎯 總結

**我想要的核心價值**:
1. **一個地方存，到處都能用** - 透過 MCP 統一存取
2. **圖片像文字一樣好搜** - 語義搜尋，不只檔名
3. **不被儲存方式綁死** - 可插拔設計，未來彈性切換
4. **自動化智慧處理** - 拖放就處理，批次就匯入
5. **工具整合順暢** - Obsidian, VSCode, Slide Generator 都能用

**請 Kiro 做的事**:
- 把這些需求轉成 User Stories
- 規劃技術架構
- 設計 API 和資料結構
- 制定開發計畫
- 開始實作

**我會提供的資源**:
- OpenAI API Key（GPT-4 Vision, Embeddings）
- Supabase 資料庫（已經有 UnifiedChunk）
- 現有的 Ink-Gateway 程式碼
- 測試用的圖片與筆記

---

**文件版本**: v1.0
**建立日期**: 2025-01-15
**作者**: Youlin Hsieh
**給**: Kiro AI - 請開始 User Story Mapping
