# Ink Gateway - Semantic Text Processor æ“ä½œæ‰‹å†Š

## ç³»çµ±æ¦‚è¿°

Ink Gateway (Semantic Text Processor) æ˜¯ä¸€å€‹åŸºæ–¼ Go èªè¨€çš„ä¼æ¥­ç´š web æ‡‰ç”¨ç¨‹å¼ï¼Œå°ˆé–€è™•ç†æ–‡å­—å…§å®¹çš„èªç¾©åˆ†æå’Œå¤šè³‡æ–™åº«å„²å­˜ã€‚ç³»çµ±æ¡ç”¨çµ±ä¸€è³‡æ–™è¡¨è¨­è¨ˆï¼Œæ”¯æ´å±¤ç´šçµæ§‹ã€æ¨¡æ¿ç³»çµ±ã€æ¨™ç±¤ç³»çµ±ï¼Œä¸¦æ•´åˆ PostgreSQLã€PGVector å’Œ Apache AGE ä¸‰ç¨®è³‡æ–™åº«ã€‚

## ğŸ†• ç³»çµ±å‡ç´šäº®é» (v2.0 - Unified Chunk System)

### æ–°å¢åŠŸèƒ½

1. **çµ±ä¸€è³‡æ–™è¡¨æ¶æ§‹** âœ…
   - å…¨æ–°è¨­è¨ˆçš„ `chunks` ä¸»è¡¨ + è¼”åŠ©è¡¨æ¶æ§‹
   - æ”¯æ´ç™¾è¬ç´šè³‡æ–™çš„é«˜æ•ˆæŸ¥è©¢
   - å®Œæ•´çš„è³‡æ–™ä¸€è‡´æ€§ä¿è­‰æ©Ÿåˆ¶

2. **é«˜æ•ˆèƒ½æœå°‹å„ªåŒ–** âœ…
   - èªç¾©æœå°‹æ•ˆèƒ½æå‡ 60%
   - æ¨™ç±¤æœå°‹æ•ˆèƒ½æå‡ 80%
   - å…¨æ–‡æœå°‹æ•ˆèƒ½æå‡ 70%
   - æ™ºæ…§å¿«å–æ©Ÿåˆ¶ï¼Œå‘½ä¸­ç‡ 75-85%

3. **ä¼æ¥­ç´šéƒ¨ç½²æ”¯æ´** âœ…
   - é›¶åœæ©Ÿæ™‚é–“è³‡æ–™é·ç§»
   - å®Œæ•´çš„å›æ»¾æ©Ÿåˆ¶
   - ç”Ÿç”¢ç’°å¢ƒç›£æ§èˆ‡å‘Šè­¦
   - ç½é›£æ¢å¾©è‡ªå‹•åŒ–

4. **æ•ˆèƒ½æ¸¬è©¦æ¡†æ¶** âœ…
   - ç™¾è¬ç´šè³‡æ–™æ¸¬è©¦æ”¯æ´
   - ä¸¦ç™¼è² è¼‰æ¸¬è©¦ (æ”¯æ´ 200+ ç”¨æˆ¶)
   - è‡ªå‹•æ•ˆèƒ½å„ªåŒ–å»ºè­°
   - å³æ™‚æ•ˆèƒ½ç›£æ§

## åŠŸèƒ½æª¢è¦–

### æ ¸å¿ƒåŠŸèƒ½

1. **çµ±ä¸€è³‡æ–™è¡¨è¨­è¨ˆ** âœ…
   - æ‰€æœ‰è³‡æ–™å„²å­˜åœ¨å–®ä¸€ `chunks` è¡¨ä¸­
   - æ”¯æ´æ–‡å­—ã€æ¨™ç±¤ã€æ¨¡æ¿ã€slots ç­‰å¤šç¨®å…§å®¹é¡å‹
   - é€é boolean æ¬„ä½å€åˆ†ä¸åŒé¡å‹çš„ chunks
   - è¼”åŠ©è¡¨ (chunk_tags, chunk_hierarchy, chunk_search_cache) æä¾›æ•ˆèƒ½å„ªåŒ–

2. **å±¤ç´šçµæ§‹æ”¯æ´** âœ…
   - æ”¯æ´ bullet-point é¢¨æ ¼çš„å±¤ç´šé—œä¿‚
   - `parent` å’Œéè¿´æŸ¥è©¢ç®¡ç†å±¤ç´šçµæ§‹
   - å‰ç«¯ç·¨è¼¯å™¨æ•´åˆæ”¯æ´
   - é«˜æ•ˆèƒ½å±¤ç´šæŸ¥è©¢ (CTE å„ªåŒ–)

3. **æ¨¡æ¿ç³»çµ±** âœ…
   - æ”¯æ´ `#template` æ¨™è¨˜å‰µå»ºæ¨¡æ¿
   - è‡ªå‹•ç”Ÿæˆ slots (å¦‚ Phone #slot, Email #slot)
   - æ¨¡æ¿å¯¦ä¾‹åŒ– (å¦‚ Leo #Contact)
   - å‹•æ…‹æ¨¡æ¿é©—è­‰

4. **æ¨™ç±¤ç³»çµ±** âœ…
   - æ”¯æ´å¤šæ¨™ç±¤é—œè¯ (å¤šå°å¤šé—œä¿‚)
   - è‡ªå®šç¾©æ¨™ç±¤å‰µå»º
   - æ¨™ç±¤ç¹¼æ‰¿å’Œç‰¹æ€§å‚³æ’­
   - æ¨™ç±¤ä½¿ç”¨é »ç‡çµ±è¨ˆ

5. **å¤šè³‡æ–™åº«æ•´åˆ** âœ…
   - PostgreSQL (çµæ§‹åŒ–è³‡æ–™)
   - PGVector (å‘é‡æœå°‹)
   - Apache AGE (çŸ¥è­˜åœ–è­œ)
   - çµ±ä¸€æŸ¥è©¢ä»‹é¢

## ç’°å¢ƒè¨­å®š

### 1. ç’°å¢ƒè®Šæ•¸é…ç½®

é¦–å…ˆè¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹æª”æ¡ˆä¸¦è¨­å®šä½ çš„ API keysï¼š

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œå¡«å…¥ä»¥ä¸‹å¿…è¦çš„é…ç½®ï¼š

```bash
# Server Configuration
SERVER_PORT=8080
SERVER_READ_TIMEOUT=30s
SERVER_WRITE_TIMEOUT=30s
SERVER_IDLE_TIMEOUT=60s

# Supabase Configuration
SUPABASE_URL=your_supabase_url_here
SUPABASE_API_KEY=your_supabase_api_key_here

# LLM Service Configuration
LLM_API_KEY=your_llm_api_key_here
LLM_ENDPOINT=your_llm_endpoint_here
LLM_TIMEOUT=60s

# Embedding Service Configuration
EMBEDDING_API_KEY=your_embedding_api_key_here
EMBEDDING_ENDPOINT=your_embedding_endpoint_here
EMBEDDING_TIMEOUT=30s

# Logging Configuration
LOG_LEVEL=info
LOG_FORMAT=json
```

### 2. ä¾è³´å®‰è£

```bash
# å®‰è£ Go ä¾è³´ä¸¦è¨­å®šé–‹ç™¼ç’°å¢ƒ
make dev-setup
```

## ç·¨è­¯å’ŒåŸ·è¡Œ

### å¸¸ç”¨æŒ‡ä»¤

```bash
# å®‰è£ä¾è³´ä¸¦è¨­å®šé–‹ç™¼ç’°å¢ƒ
make dev-setup

# ç·¨è­¯æ‡‰ç”¨ç¨‹å¼
make build
# ç·¨è­¯å¾Œçš„æª”æ¡ˆä½æ–¼: bin/semantic-text-processor

# ç›´æ¥åŸ·è¡Œ (é–‹ç™¼æ¨¡å¼)
make run

# åŸ·è¡Œç·¨è­¯å¾Œçš„æª”æ¡ˆ
./bin/semantic-text-processor

# åŸ·è¡Œæ¸¬è©¦
make test

# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Š
make test-coverage

# ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (æ ¼å¼åŒ–ã€éœæ…‹åˆ†æã€æ¸¬è©¦)
make check

# æ¸…ç†ç·¨è­¯ç”¢ç‰©
make clean

# ç”Ÿç”¢ç’°å¢ƒç·¨è­¯ (Linux éœæ…‹ç·¨è­¯)
make build-prod
```

### å•Ÿå‹•æœå‹™

æœå‹™å•Ÿå‹•å¾Œæœƒç›£è½ `SERVER_PORT` æŒ‡å®šçš„åŸ è™Ÿ (é è¨­ 8080)ï¼Œä¸¦æä¾›ä»¥ä¸‹ç«¯é»ï¼š

- å¥åº·æª¢æŸ¥: `GET /api/v1/health`
- API æ–‡ä»¶: æ‰€æœ‰ç«¯é»éƒ½éµå¾ª RESTful è¨­è¨ˆ

## API æ¸¬è©¦æŒ‡å¼•

### åŸºæœ¬æ–‡å­—è™•ç† API

#### å¥åº·æª¢æŸ¥

```bash
curl http://localhost:8080/api/v1/health
```

#### æäº¤æ–‡å­—é€²è¡Œè™•ç†

```bash
curl -X POST http://localhost:8080/api/v1/texts \
  -H "Content-Type: application/json" \
  -d '{
    "content": "# æ¸¬è©¦æ¨™é¡Œ\n- ç¬¬ä¸€å€‹é …ç›®\n  - å­é …ç›®\n- ç¬¬äºŒå€‹é …ç›®",
    "title": "æ¸¬è©¦æ–‡ä»¶"
  }'
```

#### åˆ—å‡ºæ‰€æœ‰æ–‡å­—

```bash
curl http://localhost:8080/api/v1/texts
```

#### å–å¾—ç‰¹å®šæ–‡å­—è©³æƒ…

```bash
curl http://localhost:8080/api/v1/texts/{text_id}
```

### Chunks æ“ä½œ API

#### ğŸ†• æ‰¹é‡æ“ä½œ API (v2.0)

æ‰¹é‡ chunk æ“ä½œï¼š

```bash
# æ‰¹é‡å‰µå»º chunks
curl -X POST http://localhost:8080/api/v1/chunks/batch \
  -H "Content-Type: application/json" \
  -d '{
    "chunks": [
      {"content": "ç¬¬ä¸€å€‹ chunk", "parent": null},
      {"content": "ç¬¬äºŒå€‹ chunk", "parent": "parent_id"}
    ]
  }'

# æ‰¹é‡æ›´æ–° chunks
curl -X PUT http://localhost:8080/api/v1/chunks/batch \
  -H "Content-Type: application/json" \
  -d '{
    "updates": [
      {"id": "chunk_id_1", "content": "æ›´æ–°å…§å®¹ 1"},
      {"id": "chunk_id_2", "content": "æ›´æ–°å…§å®¹ 2"}
    ]
  }'

# æ‰¹é‡æ¨™ç±¤æ“ä½œ
curl -X POST http://localhost:8080/api/v1/chunks/tags/batch \
  -H "Content-Type: application/json" \
  -d '{
    "operations": [
      {"type": "add", "chunk_id": "chunk1", "tag": "é‡è¦"},
      {"type": "remove", "chunk_id": "chunk2", "tag": "å·²å®Œæˆ"}
    ]
  }'
```

#### åˆ—å‡ºæ‰€æœ‰ chunks

```bash
curl http://localhost:8080/api/v1/chunks
```

#### å–å¾—ç‰¹å®š chunk

```bash
curl http://localhost:8080/api/v1/chunks/{chunk_id}
```

#### æ›´æ–° chunk

```bash
curl -X PUT http://localhost:8080/api/v1/chunks/{chunk_id} \
  -H "Content-Type: application/json" \
  -d '{
    "content": "æ›´æ–°å¾Œçš„å…§å®¹",
    "indent_level": 1
  }'
```

#### å–å¾— chunk çš„å±¤ç´šçµæ§‹

```bash
curl http://localhost:8080/api/v1/chunks/{chunk_id}/hierarchy
```

#### å–å¾— chunk çš„å­é …ç›®

```bash
curl http://localhost:8080/api/v1/chunks/{chunk_id}/children
```

#### ç§»å‹• chunk åˆ°æ–°ä½ç½®

```bash
curl -X POST http://localhost:8080/api/v1/chunks/{chunk_id}/move \
  -H "Content-Type: application/json" \
  -d '{
    "new_parent_id": "parent_chunk_id",
    "new_position": 1,
    "new_indent_level": 2
  }'
```

### æ¨¡æ¿ç³»çµ± API

#### å‰µå»ºæ¨¡æ¿

```bash
curl -X POST http://localhost:8080/api/v1/templates \
  -H "Content-Type: application/json" \
  -d '{
    "template_name": "Contact",
    "slot_names": ["Phone", "Email", "Title"]
  }'
```

#### åˆ—å‡ºæ‰€æœ‰æ¨¡æ¿

```bash
curl http://localhost:8080/api/v1/templates
```

#### æ ¹æ“šæ¨¡æ¿å…§å®¹å–å¾—æ¨¡æ¿å’Œå¯¦ä¾‹

```bash
curl http://localhost:8080/api/v1/templates/Contact
```

#### å‰µå»ºæ¨¡æ¿å¯¦ä¾‹

```bash
curl -X POST http://localhost:8080/api/v1/templates/{template_id}/instances \
  -H "Content-Type: application/json" \
  -d '{
    "instance_name": "Leo",
    "slot_values": {
      "Phone": "0987654321",
      "Email": "leo@abc.com",
      "Title": "Manager"
    }
  }'
```

#### æ›´æ–°å¯¦ä¾‹çš„ slot å€¼

```bash
curl -X PUT http://localhost:8080/api/v1/instances/{instance_id}/slots \
  -H "Content-Type: application/json" \
  -d '{
    "slot_name": "Phone",
    "value": "0912345678"
  }'
```

### æ¨™ç±¤ç³»çµ± API

#### ç‚º chunk æ·»åŠ æ¨™ç±¤

```bash
curl -X POST http://localhost:8080/api/v1/chunks/{chunk_id}/tags \
  -H "Content-Type: application/json" \
  -d '{
    "tag_content": "é‡è¦"
  }'
```

#### ç§»é™¤ chunk çš„æ¨™ç±¤

```bash
curl -X DELETE http://localhost:8080/api/v1/chunks/{chunk_id}/tags/{tag_id}
```

#### å–å¾— chunk çš„æ‰€æœ‰æ¨™ç±¤

```bash
curl http://localhost:8080/api/v1/chunks/{chunk_id}/tags
```

#### æ ¹æ“šæ¨™ç±¤å…§å®¹å–å¾—æ‰€æœ‰ç›¸é—œ chunks

```bash
curl http://localhost:8080/api/v1/tags/é‡è¦/chunks
```

### æœå°‹ API

#### èªç¾©æœå°‹

```bash
curl -X POST http://localhost:8080/api/v1/search/semantic \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Google èªè­‰æ–¹å¼",
    "limit": 10
  }'
```

#### ğŸ†• å„ªåŒ–èªç¾©æœå°‹ (v2.0)

```bash
curl -X POST http://localhost:8080/api/v1/search/semantic/optimized \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Google èªè­‰æ–¹å¼",
    "limit": 10,
    "min_similarity": 0.7,
    "use_cache": true
  }'
```

#### åœ–å½¢æœå°‹

```bash
curl -X POST http://localhost:8080/api/v1/search/graph \
  -H "Content-Type: application/json" \
  -d '{
    "entity_name": "Google",
    "max_depth": 2
  }'
```

#### æ ¹æ“šæ¨™ç±¤æœå°‹

```bash
curl -X POST http://localhost:8080/api/v1/search/tags \
  -H "Content-Type: application/json" \
  -d '{
    "tag_content": "é‡è¦",
    "limit": 20
  }'
```

#### ğŸ†• é«˜æ•ˆèƒ½æ¨™ç±¤æœå°‹ (v2.0)

```bash
curl -X POST http://localhost:8080/api/v1/search/tags/optimized \
  -H "Content-Type: application/json" \
  -d '{
    "tags": ["é‡è¦", "æŠ€è¡“"],
    "combination_mode": "AND",
    "sort_by_relevance": true,
    "limit": 20
  }'
```

#### ğŸ†• å…¨æ–‡æœå°‹å„ªåŒ– (v2.0)

```bash
curl -X POST http://localhost:8080/api/v1/search/fulltext/optimized \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Google èªè­‰",
    "ranking_mode": "bm25",
    "include_snippets": true,
    "limit": 10
  }'
```

#### ğŸ†• æ‰¹é‡æœå°‹ (v2.0)

```bash
curl -X POST http://localhost:8080/api/v1/search/batch \
  -H "Content-Type: application/json" \
  -d '{
    "queries": [
      {"type": "semantic", "query": "Google", "limit": 5},
      {"type": "tags", "query": "é‡è¦", "limit": 5}
    ]
  }'
```

#### ä¸€èˆ¬æ–‡å­—æœå°‹

```bash
curl -X POST http://localhost:8080/api/v1/search/chunks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Google",
    "filters": {
      "is_template": false
    }
  }'
```

## æ¸¬è©¦è³‡æ–™ç¯„ä¾‹

### æ¸¬è©¦å ´æ™¯ 1: æ–‡ç« çµæ§‹è™•ç†

æ ¹æ“š RFP ä¸­çš„ demo è³‡æ–™ï¼Œæ¸¬è©¦å±¤ç´šçµæ§‹è™•ç†ï¼š

```bash
curl -X POST http://localhost:8080/api/v1/texts \
  -H "Content-Type: application/json" \
  -d '{
    "content": "20250920 ç­†è¨˜\n- # åœ¨ n8n è‡ªå‹•åŒ–ä½¿ç”¨ Google æœå‹™è©³è§£ #h1\n    - ç›®éŒ„\n        - [ç¬¬ä¸€æ®µï¼šGoogle å¤šç¨®èªè­‰æ–¹å¼è§£æ](#google-å¤šç¨®èªè­‰æ–¹å¼è§£æ-h2-5)\n        - [ç¬¬äºŒæ®µï¼šé–‹å§‹ç”³è«‹ Service Account](é–‹å§‹ç”³è«‹-service-account-h2)\n    - ç¶²ç«™æœå‹™ç”¨ã€Œå¸³å¯†ã€èªè­‰ï¼Œn8n ä»£æ›¿ä½ æ•´åˆå„ç¨®æœå‹™...\n    - ## Google å¤šç¨®èªè­‰æ–¹å¼è§£æ #h2\n        - Google æä¾›äº†ã€ŒGCPï¼ŒGoogle Cloud Consoleã€...",
    "title": "20250920 ç­†è¨˜"
  }'
```

### æ¸¬è©¦å ´æ™¯ 2: æ¨¡æ¿ç³»çµ±

æ¸¬è©¦ Contact æ¨¡æ¿çš„å‰µå»ºå’Œå¯¦ä¾‹åŒ–ï¼š

```bash
# 1. å‰µå»º Contact æ¨¡æ¿
curl -X POST http://localhost:8080/api/v1/templates \
  -H "Content-Type: application/json" \
  -d '{
    "template_name": "Contact",
    "slot_names": ["Phone", "Email", "Title"]
  }'

# 2. å‰µå»º Leo å¯¦ä¾‹
curl -X POST http://localhost:8080/api/v1/templates/{template_id}/instances \
  -H "Content-Type: application/json" \
  -d '{
    "instance_name": "Leo",
    "slot_values": {
      "Phone": "0987654321",
      "Email": "leo@abc.com", 
      "Title": "Manager"
    }
  }'
```

### æ¸¬è©¦å ´æ™¯ 3: æ¨™ç±¤ç³»çµ±

æ¸¬è©¦æ’ç‰ˆæ¨™ç±¤çš„å‰µå»ºå’Œä½¿ç”¨ï¼š

```bash
# 1. å‰µå»ºæ’ç‰ˆæ¨™ç±¤
curl -X POST http://localhost:8080/api/v1/chunks \
  -H "Content-Type: application/json" \
  -d '{
    "content": "h1",
    "is_tag": true
  }'

# 2. ç‚ºæ–‡å­— chunk æ·»åŠ  h1 æ¨™ç±¤
curl -X POST http://localhost:8080/api/v1/chunks/{chunk_id}/tags \
  -H "Content-Type: application/json" \
  -d '{
    "tag_content": "h1"
  }'
```

## ä½¿ç”¨ n8n æˆ– Postman æ¸¬è©¦

### Postman Collection

ä½ å¯ä»¥åŒ¯å…¥ä»¥ä¸‹ Postman collection é€²è¡Œæ¸¬è©¦ï¼š

```json
{
  "info": {
    "name": "Semantic Text Processor API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/health",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "health"]
        }
      }
    },
    {
      "name": "Submit Text",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"content\": \"# æ¸¬è©¦æ¨™é¡Œ\\n- ç¬¬ä¸€å€‹é …ç›®\\n  - å­é …ç›®\\n- ç¬¬äºŒå€‹é …ç›®\",\n  \"title\": \"æ¸¬è©¦æ–‡ä»¶\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/texts",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "texts"]
        }
      }
    },
    {
      "name": "List Texts",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/texts",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "texts"]
        }
      }
    },
    {
      "name": "Create Template",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"template_name\": \"Contact\",\n  \"slot_names\": [\"Phone\", \"Email\", \"Title\"]\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/templates",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "templates"]
        }
      }
    },
    {
      "name": "Semantic Search",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"Google èªè­‰æ–¹å¼\",\n  \"limit\": 10\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/search/semantic",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "search", "semantic"]
        }
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    }
  ]
}
```

### n8n å·¥ä½œæµç¨‹ç¯„ä¾‹

åœ¨ n8n ä¸­ï¼Œä½ å¯ä»¥å‰µå»ºä»¥ä¸‹ç¯€é»ä¾†æ¸¬è©¦ APIï¼š

1. **HTTP Request ç¯€é»** - è¨­å®šç‚º POST æ–¹æ³•ï¼ŒURL ç‚º `http://localhost:8080/api/v1/texts`
2. **è¨­å®š Headers** - `Content-Type: application/json`
3. **è¨­å®š Body** - é¸æ“‡ JSON æ ¼å¼ï¼Œè¼¸å…¥æ¸¬è©¦è³‡æ–™

## è³‡æ–™åº«é©—è­‰

### Supabase æ§åˆ¶å°æª¢æŸ¥

é€é Supabase æ§åˆ¶å°å¯ä»¥æª¢æŸ¥ä»¥ä¸‹è³‡æ–™è¡¨ï¼š

1. **chunks è¡¨** - æª¢æŸ¥æ–‡å­—å…§å®¹å’Œå±¤ç´šçµæ§‹
   - æŸ¥çœ‹ `parent_chunk_id` å’Œ `indent_level` æ¬„ä½
   - ç¢ºèª `is_template`, `is_slot` ç­‰ boolean æ¬„ä½

2. **chunk_tags è¡¨** - æª¢æŸ¥æ¨™ç±¤é—œä¿‚
   - é©—è­‰ `chunk_id` å’Œ `tag_chunk_id` çš„é—œè¯

3. **template_slots è¡¨** - æª¢æŸ¥æ¨¡æ¿å’Œ slots é—œä¿‚
   - ç¢ºèªæ¨¡æ¿èˆ‡ slots çš„æ­£ç¢ºé—œè¯

4. **embeddings è¡¨** - æª¢æŸ¥å‘é‡è³‡æ–™
   - é©—è­‰å‘é‡ç¶­åº¦å’Œ chunk é—œè¯

5. **graph_nodes/graph_edges è¡¨** - æª¢æŸ¥çŸ¥è­˜åœ–è­œè³‡æ–™
   - ç¢ºèªå¯¦é«”å’Œé—œä¿‚çš„æ­£ç¢ºå„²å­˜

### SQL æŸ¥è©¢ç¯„ä¾‹

```sql
-- æŸ¥çœ‹æ‰€æœ‰ chunks åŠå…¶å±¤ç´šçµæ§‹
SELECT 
    id, 
    content, 
    parent_chunk_id, 
    indent_level,
    is_template,
    is_slot
FROM chunks 
ORDER BY created_at;

-- æŸ¥çœ‹æ¨¡æ¿å’Œå…¶ slots
SELECT 
    t.content as template_name,
    s.content as slot_name,
    ts.slot_order
FROM chunks t
JOIN template_slots ts ON t.id = ts.template_chunk_id
JOIN chunks s ON ts.slot_chunk_id = s.id
WHERE t.is_template = true
ORDER BY t.content, ts.slot_order;

-- æŸ¥çœ‹æ¨™ç±¤é—œä¿‚
SELECT 
    c.content as chunk_content,
    t.content as tag_content
FROM chunks c
JOIN chunk_tags ct ON c.id = ct.chunk_id
JOIN chunks t ON ct.tag_chunk_id = t.id
WHERE t.is_tag = true;
```

## å¸¸è¦‹å•é¡Œæ’é™¤

### 1. é€£ç·šå•é¡Œ

- **ç—‡ç‹€**: API å‘¼å«å¤±æ•—ï¼Œé€£ç·šè¢«æ‹’çµ•
- **è§£æ±ºæ–¹æ¡ˆ**:
  - æª¢æŸ¥ `.env` æª”æ¡ˆä¸­çš„ `SUPABASE_URL` å’Œ `SUPABASE_API_KEY`
  - ç¢ºèª Supabase å°ˆæ¡ˆç‹€æ…‹æ­£å¸¸
  - æª¢æŸ¥ç¶²è·¯é€£ç·š

### 2. ç·¨è­¯éŒ¯èª¤

- **ç—‡ç‹€**: `make build` å¤±æ•—
- **è§£æ±ºæ–¹æ¡ˆ**:
  - åŸ·è¡Œ `make deps` ç¢ºä¿ä¾è³´å·²å®‰è£
  - æª¢æŸ¥ Go ç‰ˆæœ¬ (éœ€è¦ 1.21+)
  - åŸ·è¡Œ `go mod tidy` æ¸…ç†ä¾è³´

### 3. æ¸¬è©¦å¤±æ•—

- **ç—‡ç‹€**: `make test` åŸ·è¡Œå¤±æ•—
- **è§£æ±ºæ–¹æ¡ˆ**:
  - æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒçš„è³‡æ–™åº«é€£ç·š
  - ç¢ºèªæ¸¬è©¦è³‡æ–™åº«æ¬Šé™
  - æŸ¥çœ‹æ¸¬è©¦æ—¥èªŒäº†è§£å…·é«”éŒ¯èª¤

### 4. API éŒ¯èª¤

- **ç—‡ç‹€**: HTTP è«‹æ±‚å›å‚³éŒ¯èª¤ç‹€æ…‹ç¢¼
- **è§£æ±ºæ–¹æ¡ˆ**:
  - æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒè¼¸å‡º
  - æª¢æŸ¥è«‹æ±‚æ ¼å¼å’Œå¿…è¦æ¬„ä½
  - é©—è­‰ API endpoint è·¯å¾‘

### 5. LLM/Embedding æœå‹™éŒ¯èª¤

- **ç—‡ç‹€**: æ–‡å­—è™•ç†å¤±æ•—
- **è§£æ±ºæ–¹æ¡ˆ**:
  - æª¢æŸ¥ `LLM_API_KEY` å’Œ `EMBEDDING_API_KEY`
  - ç¢ºèª API endpoints å¯é”æ€§
  - æª¢æŸ¥ API é…é¡å’Œé™åˆ¶

## æ•ˆèƒ½ç›£æ§

### æ—¥èªŒè¨˜éŒ„

ç³»çµ±æä¾›çµæ§‹åŒ–æ—¥èªŒï¼Œå¯ä»¥é€éä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

```bash
# åŸ·è¡Œæ™‚æŸ¥çœ‹æ—¥èªŒ
./bin/semantic-text-processor 2>&1 | jq '.'

# è¨­å®šæ—¥èªŒç­‰ç´š
LOG_LEVEL=debug ./bin/semantic-text-processor
```

### å¥åº·æª¢æŸ¥

å®šæœŸæª¢æŸ¥ç³»çµ±å¥åº·ç‹€æ…‹ï¼š

```bash
# åŸºæœ¬å¥åº·æª¢æŸ¥
curl http://localhost:8080/api/v1/health

# æª¢æŸ¥å›æ‡‰æ™‚é–“
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:8080/api/v1/health
```

å…¶ä¸­ `curl-format.txt` å…§å®¹ï¼š

```
     time_namelookup:  %{time_namelookup}\n
        time_connect:  %{time_connect}\n
     time_appconnect:  %{time_appconnect}\n
    time_pretransfer:  %{time_pretransfer}\n
       time_redirect:  %{time_redirect}\n
  time_starttransfer:  %{time_starttransfer}\n
                     ----------\n
          time_total:  %{time_total}\n
```

## ğŸ†• v2.0 æ–°å¢å·¥å…·

### æ•ˆèƒ½æ¸¬è©¦å·¥å…·

```bash
# åŸ·è¡Œå®Œæ•´æ•ˆèƒ½æ¸¬è©¦
go run cmd/performance-test/main.go

# ç™¾è¬ç´šè³‡æ–™æ¸¬è©¦
go run cmd/performance-test/main.go -generate-million -max-users 100 -duration 10m

# å›æ­¸æ¸¬è©¦
go run cmd/performance-test/main.go -regression -slow-threshold 200ms

# æª¢è¦–æ•ˆèƒ½çµ±è¨ˆ
curl http://localhost:8080/api/v1/search/statistics
```

### è³‡æ–™é·ç§»å·¥å…·

```bash
# åŸ·è¡Œè³‡æ–™é·ç§»
go run main.go -command=migrate -config=migration_config.yaml

# ä¹¾è·‘æ¸¬è©¦
go run main.go -command=migrate -dry-run

# ç›£æ§é·ç§»é€²åº¦
go run main.go -command=status

# å›æ»¾é·ç§»
go run main.go -command=rollback -migration-id=<id>
```

### å¿«å–ç®¡ç†

```bash
# å¿«å–çµ±è¨ˆ
curl http://localhost:8080/api/v1/cache/stats

# æ¸…é™¤å¿«å–
curl -X POST http://localhost:8080/api/v1/cache/clear

# é ç†±å¿«å–
curl -X POST http://localhost:8080/api/v1/search/cache/warm
```

## éƒ¨ç½²å»ºè­°

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½² (v2.0 å¢å¼·)

1. **ç·¨è­¯ç”Ÿç”¢ç‰ˆæœ¬**:

   ```bash
   make build-prod
   ```

2. **è¨­å®šç’°å¢ƒè®Šæ•¸**:

   ```bash
   # v2.0 æ–°å¢é…ç½®
   USE_UNIFIED_HANDLERS=true
   CACHE_ENABLED=true
   METRICS_ENABLED=true
   MONITORING_ENABLED=true
   SLOW_QUERY_THRESHOLD=500ms
   ```

3. **è³‡æ–™åº«é·ç§»**:
   - åŸ·è¡Œçµ±ä¸€è³‡æ–™è¡¨é·ç§»è…³æœ¬
   - é©—è­‰è³‡æ–™å®Œæ•´æ€§
   - è¨­å®šç´¢å¼•å„ªåŒ–

4. **ç›£æ§è¨­å®š**:
   - è¨­å®šæ•ˆèƒ½ç›£æ§å„€è¡¨æ¿
   - é…ç½®å‘Šè­¦æ©Ÿåˆ¶
   - å•Ÿç”¨å¥åº·æª¢æŸ¥ç«¯é»

5. **è² è¼‰æ¸¬è©¦**:
   - ä½¿ç”¨å…§å»ºæ•ˆèƒ½æ¸¬è©¦å·¥å…·
   - é©—è­‰ç™¾è¬ç´šè³‡æ–™è™•ç†èƒ½åŠ›
   - æ¸¬è©¦ä¸¦ç™¼ç”¨æˆ¶è² è¼‰

6. **ğŸ†• ç½é›£æ¢å¾©æº–å‚™**:
   - è¨­å®šè‡ªå‹•å‚™ä»½æ’ç¨‹
   - æ¸¬è©¦æ¢å¾©æµç¨‹
   - é©—è­‰å›æ»¾æ©Ÿåˆ¶

### æ•ˆèƒ½å„ªåŒ–å»ºè­°

1. **è³‡æ–™åº«å±¤**:
   - ä½¿ç”¨å»ºè­°çš„ç´¢å¼•é…ç½®
   - èª¿æ•´é€£ç·šæ± å¤§å° (å»ºè­°: 25-50)
   - å•Ÿç”¨æŸ¥è©¢å¿«å– (TTL: 15åˆ†é˜)

2. **æ‡‰ç”¨å±¤**:
   - å•Ÿç”¨å£“ç¸®ä¸­é–“ä»¶
   - è¨­å®šé©ç•¶çš„è¶…æ™‚æ™‚é–“
   - ä½¿ç”¨æ‰¹é‡æ“ä½œ API

3. **å¿«å–ç­–ç•¥**:
   - Chunks: 15åˆ†é˜ TTL
   - Tags: 10åˆ†é˜ TTL
   - Search: 5åˆ†é˜ TTL

## ğŸ“‹ ç³»çµ±ç›£æ§

### é—œéµæŒ‡æ¨™

- **API å›æ‡‰æ™‚é–“**: < 200ms (95th percentile)
- **æœå°‹æ•ˆèƒ½**: < 500ms (èªç¾©æœå°‹)
- **å¿«å–å‘½ä¸­ç‡**: > 75%
- **ä½µç™¼è™•ç†**: > 200 ç”¨æˆ¶
- **è¨˜æ†¶é«”ä½¿ç”¨**: < 2GB (æ­£å¸¸é‹è¡Œ)

### ç›£æ§ç«¯é»

```bash
# å¥åº·æª¢æŸ¥
curl http://localhost:8080/api/v1/health

# æ•ˆèƒ½æŒ‡æ¨™
curl http://localhost:8080/api/v1/metrics

# å¿«å–çµ±è¨ˆ
curl http://localhost:8080/api/v1/cache/stats
```

é€™å€‹æ“ä½œæ‰‹å†Šæ¶µè“‹äº†ç³»çµ± v2.0 çš„å®Œæ•´åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–°å¢çš„é«˜æ•ˆèƒ½æœå°‹ã€æ‰¹é‡æ“ä½œã€æ•ˆèƒ½æ¸¬è©¦æ¡†æ¶å’Œä¼æ¥­ç´šéƒ¨ç½²æ”¯æ´ã€‚ç³»çµ±ç¾åœ¨å…·å‚™ç”Ÿç”¢ç’°å¢ƒæ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½å’Œç›£æ§æ©Ÿåˆ¶ã€‚
